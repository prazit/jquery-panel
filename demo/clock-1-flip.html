<!DOCTYPE html>
<html>

<!-- excluded -->
<head>
    <title>Flip Clock for clock-1.html</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="focus-3.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="http://localhost/scbs/css/sym-fa.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="http://localhost/scbs/css/ani-anicss.css"/>

    <style>
        .clock {
            position: absolute;
            width: 100vh;
            height: 100vh;
            left: calc((100vw - 100vh) / 2);
        }
    </style>
</head>

<!-- inside body tag will be included -->
<body class="css-trans fixed background--c0 fit-width fit-height" style="font-family: Arial,sans-serif;">

<style>
    .ani-reset-top-flip {
        transform: rotateX(0deg);
    }

    .ani-reset-bottom-flip {
        transform: rotateX(90deg);
    }

    @keyframes ani-top-flip {
        0% {
            transform: rotateX(0deg);
        }
        100% {
            transform: rotateX(-90deg);
        }
    }

    .ani-top-flip {
        -webkit-animation-name: ani-top-flip;
        animation-name: ani-top-flip;
    }

    @keyframes ani-bottom-flip {
        0% {
            transform: rotateX(90deg);
        }
        100% {
            transform: rotateX(0deg);
        }
    }

    .ani-bottom-flip {
        -webkit-animation-name: ani-bottom-flip;
        animation-name: ani-bottom-flip;
    }

    .flipper {
        font-size: 74px;
        transform: perspective(888px);
        transform-origin: 180px 180px;
        transform-style: preserve-3d;
    }

    #second-parts svg,
    #minute-parts svg,
    #hour-parts svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .flip-ui svg {
        opacity: 0;
    }

    .flip-ui:hover svg {
        opacity: 1;
    }

    .flip-ui:hover .flip-origin-1 {
        cx: 45;
        cy: 45;
    }

    .flip-ui:hover .flip-origin-2 {
        cx: 100;
        cy: 22;
    }

    .flip-ui:hover .flip-origin-3 {
        cx: 155.5;
        cy: 45;
    }

    .flip-ui .button:hover {
        r: 20;
        stroke-width: 3;
        stroke: white;
        cursor: pointer;
    }
</style>

<div class="clock numbers">
    <svg></svg>
</div>

<div class="clock five minutes">
    <div class="clock number-id">
        <svg></svg>
    </div>
</div>

<div class="clock one minutes">
    <div class="clock number-id">
        <svg></svg>
    </div>
</div>

<div class="clock second">
    <svg></svg>
</div>

<div class="clock minute">
    <svg></svg>
</div>

<div class="clock hour">
    <svg></svg>
</div>

<div id="second-parts" class="clock sysfont flipper">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="top-part">
        <clipPath id="top-mask" clipPathUnits="userSpaceOnUse">
            <rect x="0" y="0" width="300" height="150"></rect>
        </clipPath>
        <rect id="pad" x="205" y="110" width="80" height="80" rx="10" clip-path="url(#top-mask)"></rect>
        <text id="number" x="205" y="178" stroke-width="0" clip-path="url(#top-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="bottom-part">
        <clipPath id="bottom-mask" clipPathUnits="userSpaceOnUse">
            <rect x="0" y="150" width="300" height="150"></rect>
        </clipPath>
        <rect id="pad" x="205" y="110" width="80" height="80" rx="10" clip-path="url(#bottom-mask)"></rect>
        <text id="number" x="205" y="178" stroke-width="0" clip-path="url(#bottom-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="top-flip" class="hidden ani-reset-top-flip">
        <rect id="pad" x="205" y="110" width="80" height="80" rx="10" clip-path="url(#top-mask)"></rect>
        <text id="number" x="205" y="178" stroke-width="0" clip-path="url(#top-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="bottom-flip" class="hidden ani-reset-bottom-flip">
        <rect id="pad" x="205" y="110" width="80" height="80" rx="10" clip-path="url(#bottom-mask)"></rect>
        <text id="number" x="205" y="178" stroke-width="0" clip-path="url(#bottom-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="center-line">
        <rect x="205" y="150" width="80" height="1"></rect>
    </svg>
</div>

<div id="minute-parts" class="clock sysfont flipper">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="top-part">
        <rect id="pad" x="110" y="110" width="80" height="80" rx="10" clip-path="url(#top-mask)"></rect>
        <text id="number" x="109.5" y="178" stroke-width="0" clip-path="url(#top-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="bottom-part">
        <rect id="pad" x="110" y="110" width="80" height="80" rx="10" clip-path="url(#bottom-mask)"></rect>
        <text id="number" x="109.5" y="178" stroke-width="0" clip-path="url(#bottom-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="top-flip" class="hidden ani-reset-top-flip">
        <rect id="pad" x="110" y="110" width="80" height="80" rx="10" clip-path="url(#top-mask)"></rect>
        <text id="number" x="109.5" y="178" stroke-width="0" clip-path="url(#top-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="bottom-flip" class="hidden ani-reset-bottom-flip">
        <rect id="pad" x="110" y="110" width="80" height="80" rx="10" clip-path="url(#bottom-mask)"></rect>
        <text id="number" x="109.5" y="178" stroke-width="0" clip-path="url(#bottom-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="center-line">
        <rect x="109.5" y="150" width="80" height="1"></rect>
    </svg>
</div>

<div id="hour-parts" class="clock sysfont flipper">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="top-part">
        <rect id="pad" x="15" y="110" width="80" height="80" rx="10" clip-path="url(#top-mask)"></rect>
        <text id="number" x="14.5" y="178" stroke-width="0" clip-path="url(#top-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="bottom-part">
        <rect id="pad" x="15" y="110" width="80" height="80" rx="10" clip-path="url(#bottom-mask)"></rect>
        <text id="number" x="14.5" y="178" stroke-width="0" clip-path="url(#bottom-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="top-flip" class="hidden ani-reset-top-flip">
        <rect id="pad" x="15" y="110" width="80" height="80" rx="10" clip-path="url(#top-mask)"></rect>
        <text id="number" x="14.5" y="178" stroke-width="0" clip-path="url(#top-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="bottom-flip" class="hidden ani-reset-bottom-flip">
        <rect id="pad" x="15" y="110" width="80" height="80" rx="10" clip-path="url(#bottom-mask)"></rect>
        <text id="number" x="14.5" y="178" stroke-width="0" clip-path="url(#bottom-mask)"></text>
    </svg>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 300 300"
         id="center-line">
        <rect x="14.5" y="150" width="80" height="1"></rect>
    </svg>
</div>

<div class="hidden ticker center-text middle-text"></div>

<div class="flip-ui fit-width" style="height:50% !important;overflow:hidden;">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 200 100" class="css-trans">
        <text fill="white" x="40.5" y="50" class="css-trans--x2">1</text>
        <text fill="white" x="95.5" y="27" class="css-trans--x2">2</text>
        <text fill="white" x="151" y="50" class="css-trans--x2">3</text>
        <text fill="silver" x="50" y="70" class="css-trans">3D Origin Styles</text>
        <circle fill="silver" cx="100" cy="100" r="15" class="button flip-origin-1 opacity--x60 css-trans"></circle>
        <circle fill="silver" cx="100" cy="100" r="15" class="button flip-origin-2 opacity--x60 css-trans"></circle>
        <circle fill="silver" cx="100" cy="100" r="15" class="button flip-origin-3 opacity--x60 css-trans"></circle>
    </svg>
</div>

<script>
    let flipGroup = window['FlipGroup'] = function (index) {
        this.index = index;
    };
    flipGroup.prototype = {
        number: '',
        setTimeout: function (func, millisec) {
            this.clearTimeout();
            this.timeout = setTimeout(func, millisec);
        },
        clearTimeout: function () {
            if (this.timeout !== undefined) {
                clearTimeout(this.timeout);
                delete this.timeout;
            }
        },
        originX: 0,
        originY: 0,
        perspective: 450,
        screenCenterX: 0,
        screenCenterY: 0,
        attr: function (name, value) {
            if (value === undefined)
                return this[name];
            else {
                this[name] = value;
                this.reposition();
            }
        },
        toCenterOfClock: function (clockXDegree, clockYDegree) {
            /*Notice: move origin to center of clock*/
            var width = parseFloat(this.$.css('width')),
                centerX = width * 0.5,
                centerY = width * 0.5,
                perspectiveX = 450,
                perspectiveY = 450,
                maxDegree = 10,
                percent;
            if (clockXDegree !== undefined && clockXDegree !== 0) {
                percent = (clockXDegree % 360) / maxDegree * -1;
                console.warn('to Degree Of X-Rotation:' + `center = ${centerY}, relative = ${centerY * percent}, percent = ${percent}, degree = ${clockYDegree}`);
                centerY += centerY * percent;
                perspectiveY = 450 + (Math.abs(percent) * 450);
            }
            if (clockYDegree !== undefined && clockYDegree !== 0) {
                percent = (clockYDegree % 360) / maxDegree * -1;
                console.warn('to Degree Of Y-Rotation:' + `center = ${centerX}, relative = ${centerX * percent}, percent = ${percent}, degree = ${clockYDegree}`);
                centerX += centerX * percent;
                perspectiveX = 450 + (Math.abs(percent) * 450);
            }
            this.originX = centerX;
            this.originY = centerY;
            this.perspective = Math.max(perspectiveX, perspectiveY);
        },
        toCenterOfFlipper: function (clockXDegree, clockYDegree) {
            /*Notice: move origin to center of flipper*/
            var width = parseFloat(this.$.css('width')),
                center = width * 0.5,
                ratio = width / 300,
                flipperX = parseFloat(this.bottomFlipPad.css('x')) * ratio,
                flipperW = parseFloat(this.bottomFlipPad.css('width')) * ratio,
                centerX = (flipperW * 0.5) + flipperX,
                flipperY = parseFloat(this.bottomFlipPad.css('y')) * ratio,
                flipperH = parseFloat(this.bottomFlipPad.css('height')) * ratio,
                centerY = (flipperH * 0.5) + flipperY,
                perspectiveX = 450,
                perspectiveY = 450,
                maxDegree = 10,
                percent;
            if (clockXDegree !== undefined && clockXDegree !== 0) {
                percent = (clockXDegree % 360) / maxDegree * -1;
                console.warn('to Degree Of Y-Rotation:' + `center = ${center}, relative = ${center * percent}, percent = ${percent}, degree = ${clockYDegree}`);
                centerY += center * percent;
                perspectiveY = 450 + (Math.abs(percent) * 100);
            }
            if (clockYDegree !== undefined && clockYDegree !== 0) {
                percent = (clockYDegree % 360) / maxDegree * -1;
                console.warn('to Degree Of Y-Rotation:' + `center = ${center}, relative = ${center * percent}, percent = ${percent}, degree = ${clockYDegree}`);
                centerX += center * percent;
                perspectiveX = 450 + (Math.abs(percent) * 100);
            }
            this.originX = centerX;
            this.originY = centerY;
            this.perspective = Math.max(perspectiveX, perspectiveY);
        },
        toCenterOfScreen: function () {
            /*Notice: move origin to center of screen*/
            var screenW = parseFloat(window.innerWidth),
                screenH = parseFloat(window.innerHeight),
                screenCenterX = screenW * 0.5,
                screenCenterY = screenH * 0.5,
                width = parseFloat(this.$.css('width')),
                rect = this.$[0].getBoundingClientRect(),
                left = rect.left,
                top = rect.top,
                center = width * 0.5,
                diffX = screenCenterX - (center + left),
                diffY = screenCenterY - (center + top);
            this.perspective = 450 + (900 * Math.abs(center / diffX));
            this.originX = center + diffX;
            this.originY = center + diffY;
        },
        reposition: function () {
            var buttons = $('.flip-ui .button').css('fill', 'silver'),
                clock = Appanel.clock,
                attributes = clock.backgroundAttributes;

            switch (clock.options.originType) {
                case 2:
                    this.toCenterOfClock(attributes.clockXDegree, attributes.clockYDegree);
                    buttons.filter('.flip-origin-2').css('fill', 'yellow');
                    break;
                case 3:
                    if (attributes.clockYDegree !== 0) {
                        this.toCenterOfClock(attributes.clockXDegree, attributes.clockYDegree);
                    } else {
                        this.toCenterOfScreen();
                    }
                    buttons.filter('.flip-origin-3').css('fill', 'yellow');
                    break;
                default:
                    this.toCenterOfFlipper(attributes.clockXDegree, attributes.clockYDegree);
                    buttons.filter('.flip-origin-1').css('fill', 'yellow');
            }
            this.attributeChanged();
        },
        attributeChanged: function () {
            this.$
                .css('transform', `perspective(${this.perspective}px)`)
                .css('transform-origin', `${this.originX}px ${this.originY}px`);
        }
    };

    Appanel({

        /**
         * Flip Clock reuse components of Analogue Clock
         * background < background
         * frame < frame
         * hour number, minute number, second number < numbers
         * not use < five-minutes, one-minutes
         * frame of second number < second
         * frame of minute number < minute
         * frame of hour number < hour
         */
        flip: {
            ui: {
                handle: function () {
                    $(Appanel.clock).off('clock:resize')
                        .on('clock:resize', function () {
                            Appanel.flip.setTimeout(function () {
                                Appanel.flip.reposition();
                            }, 100);
                        });

                    /*handle ui-panel*/
                    Appanel.clock.ui.handleSwitch('top', '.flip-ui');

                    /*handle flip origin switches on ui-panel*/
                    Appanel.map([
                        [$('.flip-origin-1'), 'click', function () {
                            Appanel.clock.options.originType = 1;
                            Appanel.flip.reposition();
                            Appanel.clock.saveOptions();
                        }],
                        [$('.flip-origin-2'), 'click', function () {
                            Appanel.clock.options.originType = 2;
                            Appanel.flip.reposition();
                            Appanel.clock.saveOptions();
                        }],
                        [$('.flip-origin-3'), 'click', function () {
                            Appanel.clock.options.originType = 3;
                            Appanel.flip.reposition();
                            Appanel.clock.saveOptions();
                        }]
                    ]);
                },
                initProfile: function () {
                    /*Remember: this function will called from the Appanel.clock*/
                    var flip = Appanel.flip,
                        clock = this;

                    if (Appanel.profile === undefined) {
                        /*Remember: original Appanel.clock.initProfile() has renamed to flip*/
                        clock.flip.call(clock);
                    }

                    var theme = Appanel.profile.theme,
                        util = Appanel.util,
                        s = flip.groups[0],
                        m = flip.groups[1],
                        h = flip.groups[2],
                        $seconds = util.merge([s.topPart.find("#pad"), s.bottomPart.find("#pad"), s.topFlip.find("#pad"), s.bottomFlipPad]);
                    console.debug('$flipSecond =', $seconds);

                    theme.add('flipSecond', 'fill', $seconds, 'handSecond', false);
                    theme.add('flipMinute', 'fill', util.merge([m.topPart.find("#pad"), m.bottomPart.find("#pad"), m.topFlip.find("#pad"), m.bottomFlipPad]), 'handMinute', false);
                    theme.add('flipHour', 'fill', util.merge([h.topPart.find("#pad"), h.bottomPart.find("#pad"), h.topFlip.find("#pad"), h.bottomFlipPad]), 'handHour', false);
                    theme.add('fnumbers', ['fill', 'stroke'], util.merge([
                        s.topPartNumber, s.bottomPartNumber, s.topFlipNumber, s.bottomFlipNumber,
                        m.topPartNumber, m.bottomPartNumber, m.topFlipNumber, m.bottomFlipNumber,
                        h.topPartNumber, h.bottomPartNumber, h.topFlipNumber, h.bottomFlipNumber
                    ]), 'numbers', false);
                    theme.add('fline', 'fill', util.merge([s.$.find('#center-line'), m.$.find('#center-line'), h.$.find('#center-line')]), 'background', false);

                    /*TODO: add UI components*/

                    theme.refresh();
                },
                init: function () {
                    this.handle();
                    if (Appanel.clock.flip === undefined) {
                        Appanel.clock.flip = Appanel.clock.initProfile;
                        Appanel.clock.initProfile = this.initProfile;
                        if (Appanel.profile !== undefined) this.initProfile.call(Appanel.clock);
                    } else {
                        this.initProfile();
                    }
                }
            },

            setTimeout: function (func, millisec) {
                this.clearTimeout();
                this.timeout = setTimeout(func, millisec);
            },
            clearTimeout: function () {
                if (this.timeout !== undefined) {
                    clearTimeout(this.timeout);
                    delete this.timeout;
                }
            },

            flipStart: function (groupIndex) {
                var group = this.groups[groupIndex];
                group.topPartNumber.text(group.number);
            },

            flipEnd: function (groupIndex) {
                var group = this.groups[groupIndex];
                group.bottomPartNumber.text(group.number);
            },

            play: function (groupIndex) {
                var group = this.groups[groupIndex];
                group.bottomFlipNumber.text(group.number);
                group.$.sweep(group.sweeper);
            },

            /**
             * Group Index: 0, 1, 2
             * Group Name: Second, Minute, Hour
             */
            groups: [
                new FlipGroup(0),
                new FlipGroup(1),
                new FlipGroup(2)
            ],

            reposition: function () {
                this.groups[0].reposition();
                this.groups[1].reposition();
                this.groups[2].reposition();
            },

            setDirectNumber: function (number, groupIndex) {
                var group = this.groups[groupIndex];
                group.prevNumber = group.number;
                group.number = number;
                group.topPartNumber.text(number);
                group.bottomPartNumber.text(number);
                group.topFlipNumber.text(number);
                group.bottomFlipNumber.text(number);
            },

            setNumber: function (number, groupIndex) {
                var group = this.groups[groupIndex];

                if (number === group.number) return;
                group.prevNumber = group.number;
                group.number = number;

                /*set old number*/
                group.topFlipNumber.text(group.prevNumber);
                group.topFlip.addClass('ani-reset-top-flip').removeClass('hidden');

                group.bottomPartNumber.text(group.prevNumber);
                group.bottomFlip.addClass('hidden ani-reset-top-flip');

                /* delay start animation or waiting all above to take effect on screen*/
                group.setTimeout(function () {
                    Appanel.flip.play.call(Appanel.flip, groupIndex);
                }, 100);
            },

            initGroup: function (selector, groupIndex) {
                var group = this.groups[groupIndex];
                group.$ = $(selector);

                group.topPart = group.$.find('#top-part');
                group.bottomPart = group.$.find('#bottom-part');

                group.topFlip = group.$.find('#top-flip');
                group.bottomFlip = group.$.find('#bottom-flip');

                group.topPartNumber = group.topPart.find('#number');
                group.bottomPartNumber = group.bottomPart.find('#number');
                group.topFlipNumber = group.topFlip.find('#number');
                group.bottomFlipNumber = group.bottomFlip.find('#number');

                group.bottomFlipPad = group.bottomFlip.find('#pad');

                group.duration = 0.20 * (groupIndex + 1);
                group.sweeper = {
                    on: 'sweep:ready',
                    duration: 0.001,
                    remove: 'hidden',
                    sweep: [{
                        selector: group.topFlip,
                        remove: 'hidden ani-reset-top-flip',
                        play: 'ani-top-flip',
                        duration: group.duration,
                        timing: 'linear',
                        groupIndex: groupIndex,
                        run: function () {
                            Appanel.flip.flipStart.call(Appanel.flip, this.groupIndex);
                        },
                        sweep: [
                            {
                                selector: group.bottomFlip,
                                remove: 'hidden ani-reset-bottom-flip',
                                play: 'ani-bottom-flip',
                                duration: group.duration,
                                timing: 'linear',
                                sweep: [
                                    {
                                        selector: group.bottomFlip,
                                        remove: 'ani-bottom-flip',
                                        add: 'hidden ani-reset-bottom-flip',
                                        duration: 0.001,
                                        groupIndex: groupIndex,
                                        run: function () {
                                            Appanel.flip.flipEnd.call(Appanel.flip, this.groupIndex);
                                        }
                                    }
                                ]
                            },
                            {
                                selector: group.topFlip,
                                remove: 'ani-top-flip',
                                add: 'hidden ani-reset-top-flip',
                                duration: 0.001
                            }
                        ]
                    }]
                };
            },

            init: function () {
                this.initGroup('#second-parts', 0);
                this.initGroup('#minute-parts', 1);
                this.initGroup('#hour-parts', 2);
                this.ui.init();
            },

            start: function () {
                this.init();

                /*Core of the clock*/
                $('.ticker').on('html:changed', function (ev, type) {
                    if (type === 'text') {
                        var times = ev.currentTarget.innerHTML.split(':'),
                            flip = Appanel.flip;
                        flip.setNumber(times[0], 2);
                        flip.setNumber(times[1], 1);
                        flip.setNumber(times[2], 0);
                    }
                });
            }
        },

        ready: function () {
            this.flip.start();
        }
    });
</script>

</body>
</html>