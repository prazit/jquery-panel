<!DOCTYPE html>
<html>

<head>
    <title>Analog Clock using focus-3.html</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="focus-3.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="http://localhost/scbs/css/sym-fa.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="http://localhost/scbs/css/ani-anicss.css"/>

    <!-- animation -->
    <style>

        @keyframes ani-clock {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .ani-clock {
            -webkit-animation-name: ani-clock;
            animation-name: ani-clock;
        }

        .clock {
            position: absolute;
            width: 100vh;
            height: 100vh;
            left: calc((100vw - 100vh) / 2);
            display: none;
        }

        .minutes > div {
            position: absolute;
            width: 100vh;
            height: 100vh;
        }

        .css-trans {
            transition-duration: 0.2s;
        }
    </style>
</head>

<body class="css-trans fixed background--c0 fit-width fit-height" style="font-family: Arial,sans-serif;">

<div class="clock numbers">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 200 200"
         stroke="gold"
         fill="#000033"
         style="width:100%">
        <circle cx="100" cy="100" r="98"
                stroke-opacity="1" stroke-width="2"
                stroke-linecap="butt"
                stroke-dashoffset="0" stroke-dasharray="0"/>
        <text x="90.5" y="17">12</text>
        <text x="7" y="105">9</text>
        <text x="95.5" y="194.5">6</text>
        <text x="184.5" y="105">3</text>
    </svg>
</div>

<div class="clock five minutes">
    <div class="number-id">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
             viewBox="0 0 200 200"
             stroke="gold"
             fill="gold"
             style="width:100%">
            <line x1="100" x2="100" y1="3" y2="12" stroke-width="2"></line>
        </svg>
    </div>
</div>

<div class="clock one minutes">
    <div class="number-id">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
             viewBox="0 0 200 200"
             stroke="gold"
             fill="gold"
             style="width:100%">
            <line x1="100" x2="100" y1="3" y2="7" stroke-width="1"></line>
        </svg>
    </div>
</div>

<div class="clock second">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 200 200"
         stroke="gold"
         fill="gold"
         style="width:100%">
        <circle class='hidden' cx="100" cy="100" r="5" fill="lightgreen"/>
        <circle class='opacity--x10' cx="100" cy="100" r="76"
                fill="transparent"
                stroke-opacity="1" stroke-width="2"
                stroke-linecap="butt"
                stroke-dashoffset="0" stroke-dasharray="2"/>
        <polygon class='hidden' points="100,19 103,22 97,22 100,19" stroke-width="1"/>
        <line x1="100" x2="100" y1="23" y2="100" stroke-width="2" stroke-linecap="round"></line>
    </svg>
</div>

<div class="clock minute">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 200 200"
         stroke="silver"
         fill="silver"
         style="width:100%">
        <circle class='hidden' cx="100" cy="100" r="4"/>
        <circle class='opacity--x10' cx="100" cy="100" r="60"
                fill="transparent"
                stroke-opacity="1" stroke-width="5"
                stroke-linecap="butt"
                stroke-dashoffset="0" stroke-dasharray="2"/>
        <polygon class='hidden' points="100,31 104,36 96,36 100,31" stroke-width="1"/>
        <line x1="100" x2="100" y1="37" y2="100" stroke-width="2.7" stroke-linecap="round"></line>
    </svg>
</div>

<div class="clock hour">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
         viewBox="0 0 200 200"
         stroke="red"
         fill="red"
         style="width:100%">
        <circle cx="100" cy="100" r="4"/>
        <circle class='opacity--x10' cx="100" cy="100" r="40"
                fill="transparent"
                stroke-opacity="1" stroke-width="7"
                stroke-linecap="butt"
                stroke-dashoffset="0" stroke-dasharray="2"/>
        <polygon class='hidden' points="100,50 104,55 96,55 100,50" stroke-width="1"/>
        <line x1="100" x2="100" y1="56" y2="100" stroke-width="3.5" stroke-linecap="round"></line>
    </svg>
</div>

<!-- ticker -->
<div class="on-top-right padding--x5 hidden">
    <span class="text--c3 text--x2 ticker"></span>
</div>

<!-- colors -->
<div class="css-trans on-right theme margin--x10 opacity--x0 opacity--x100--at columns" style="align-items:center">
    <div class="column-1-2 padding--x-5">
        <div class="rounded--x50 border--x4 border--c3">
            <span class="profile-list button top-child background--c1 background--c0--at padding--x10 center-text">Profiles</span>
            <div class="profile-container">
                <span class="profile button child background--c1 background--c0--at padding--x10 left-text">profile-name</span>
            </div>
            <span class="add-profile button bottom-child background--c1 background--c0--at padding--x10 center-text">+</span>
        </div>
    </div>
    <div class="column-1-2 padding--x-5">
        <div class="rounded--x50 border--x4 border--c3 colors">
            <span class="profile-name button top-child background--c1 background--c0--at padding--x10 center-text">Profile</span>
            <span class="color-handSecond button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Second Hand</span>
            <span class="color-handMinute button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Minute Hand</span>
            <span class="color-handHour button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Hour Hand</span>
            <span class="color-numbers button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Numbers</span>
            <span class="color-minutes button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Minutes</span>
            <span class="color-fiveMinutes button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Five Minutes</span>
            <span class="color-frame button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Frame</span>
            <span class="color-background button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Background</span>
            <span class="color-outSide button bottom-child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Outside</span>
        </div>
    </div>
</div>

<!-- input -->
<div class="input-panel opacity--x0" style="overflow:hidden;max-width:0px;">
    <label>Please enter value:</label>
    <input type="text" value="10" class="text--c0 width--fit"/>
</div>

<!-- JS -->
<script type="text/javascript" src="http://localhost/jquery/1.11/jquery.js"></script>
<script type="text/javascript" src="../dist/jquery.panel.suite.min.js"></script>
<script type="text/javascript" src="../src/jquery.theme.js"></script>
<script>
    Appanel({
        clock: {
            useSweep: false,

            setSecond: function (second) {
                this.percentSecond = second / 60;
                if (!this.useSweep) {
                    this.$second.css('transform', 'rotate(' + (this.percentSecond * 360) + 'deg)');
                    if (second === 59) {
                        this.timeout = setTimeout(function () {
                            Appanel.clock.$second.removeClass('css-trans');
                            Appanel.clock.$second.css('transform', 'rotate(-6deg)');
                            clearTimeout(Appanel.clock.timeout);
                            Appanel.clock.timeout = setTimeout(function () {
                                Appanel.clock.$second.addClass('css-trans');
                                clearTimeout(Appanel.clock.timeout);
                            }, 200);
                        }, 200);
                    }
                }
                this.second = second;
            },

            setMinute: function (minute) {
                this.percentMinute = (minute + this.percentSecond) / 60;
                if (!this.useSweep) {
                    this.minuteDegree = (this.percentMinute * 360);
                    this.$minute.css('transform', 'rotate(' + this.minuteDegree + 'deg)');
                    if (minute === 59) {
                        this.timeout = setTimeout(function () {
                            Appanel.clock.$minute.removeClass('css-trans');
                            Appanel.clock.$minute.css('transform', 'rotate(-' + (360 - Appanel.clock.minuteDegree) + 'deg)');
                            clearTimeout(Appanel.clock.timeout);
                            Appanel.clock.timeout = setTimeout(function () {
                                Appanel.clock.$minute.addClass('css-trans');
                                clearTimeout(Appanel.clock.timeout);
                            }, 200);
                        }, 200);
                    }

                    // update hour hand at every minute
                    if (this.hour !== undefined) this.setHour(this.hour);
                }
                this.minute = minute;
            },

            setHour: function (hour) {
                if (!this.useSweep) {
                    this.hourDegree = ((hour + this.percentMinute) / 12) * 360;
                    this.$hour.css('transform', 'rotate(' + this.hourDegree + 'deg)');
                    if (hour === 11) {
                        this.timeout = setTimeout(function () {
                            Appanel.clock.$hour.removeClass('css-trans');
                            Appanel.clock.$hour.css('transform', 'rotate(-' + (360 - Appanel.clock.hourDegree) + 'deg)');
                            clearTimeout(Appanel.clock.timeout);
                            Appanel.clock.timeout = setTimeout(function () {
                                Appanel.clock.$hour.addClass('css-trans');
                                clearTimeout(Appanel.clock.timeout);
                            }, 200);
                        }, 200);
                    }
                }
                this.hour = hour;
            },

            refreshTime: function () {
                this.ticker[0].innerText = this.hour + ':' + this.minute + ':' + this.second;
            },

            secondTick: function () {
                var second = this.second + 1;
                if (second === 60)
                    this.minuteTick();
                else
                    this.setSecond(second);
            },

            minuteTick: function () {
                this.setSecond(0);

                var minute = this.minute + 1;
                if (minute === 60)
                    this.hourTick();
                else
                    this.setMinute(minute);
            },

            hourTick: function () {
                this.setMinute(0);

                var hour = this.hour + 1;
                if (hour === 24)
                    this.setHour(0);
                else
                    this.setHour(hour);
            },

            initProfile: function () {
                var theme = new Theme();
                theme.add('handSecond', ['stroke', 'fill'], $('.second svg'));
                theme.add('handMinute', ['stroke', 'fill'], $('.minute svg'));
                theme.add('handHour', ['stroke', 'fill'], $('.hour svg'));
                theme.add('numbers', ['stroke', 'fill'], $('.numbers text'));
                theme.add('minutes', ['stroke', 'fill'], $('.one.minutes line'));
                theme.add('fiveMinutes', ['stroke', 'fill'], $('.five.minutes line'));
                theme.add('frame', 'stroke', $('.numbers circle'));
                theme.add('background', 'fill', $('.numbers circle'));
                theme.add('outSide', 'background-color', $(document.getElementsByTagName('body')));

                theme.add('chandSecond', 'background-color', $('.color-handSecond'), 'handSecond');
                theme.add('chandMinute', 'background-color', $('.color-handMinute'), 'handMinute');
                theme.add('chandHour', 'background-color', $('.color-handHour'), 'handHour');
                theme.add('cnumbers', 'background-color', $('.color-numbers'), 'numbers');
                theme.add('cminutes', 'background-color', $('.color-minutes'), 'minutes');
                theme.add('cfiveMinutes', 'background-color', $('.color-fiveMinutes'), 'fiveMinutes');
                theme.add('cframe', 'background-color', $('.color-frame'), 'frame');
                theme.add('cbackground', 'background-color', $('.color-background'), 'background');
                theme.add('coutSide', 'background-color', $('.color-outSide'), 'outSide');

                this.handle(new Profile('analogue-clock', theme));
            },

            handle: function (profile) {
                Appanel['profile'] = profile;

                if (!profile.contains('default')) {
                    profile.save('default', {
                        handSecond: 'red',
                        handMinute: 'orange',
                        handHour: 'gold',
                        numbers: 'gold',
                        minutes: '#000000',
                        fiveMinutes: '#222222',
                        frame: 'silver',
                        background: 'navy',
                        outSide: 'bluesky'
                    });
                }

                var e = $('.theme .profile'),
                    container = e.parents('.profile-container'),
                    template = container[0].innerHTML,
                    count = profile.ids.length,
                    theme = profile.theme,
                    themeProperty;

                // handle profile buttons
                container[0].innerHTML = "";
                for (var i = 0; i < count; i++) {
                    container.append(template.replace('profile-name', profile.ids[i]));
                    button = container.find('.profile').removeClass('profile');
                    Appanel.map([
                        [button, 'click', function (ev) {
                            Appanel.profile.load(ev.data.profile);
                            $('.profile-name')[0].innerText = ev.data.profile;
                        }, {theme: profile.theme, profile: profile.ids[i]}]
                    ]);
                    if (profile.ids[i] === profile.current) button.click();
                }

                // handle add profile button
                Appanel.map([[$('.theme .add-profile'), 'click', function (ev) {
                    Appanel.util.input('New Profile', 'Enter profile name:', 'default',
                        function (data, name) {
                            if (Appanel.profile.contains(name)) {
                                alert('Profile ' + name + ' already exists!');
                            } else {
                                Appanel.profile.save(name);
                                Appanel.util.refresh();
                            }
                        });
                }]]);

                // handle profile name button
                button = $('.theme .profile-name');
                Appanel.map([[button, 'click', function (ev) {
                    var oldName = ev.currentTarget.innerText;
                    Appanel.util.input('Change Profile Name', 'Enter new name:', oldName,
                        function (data, newName) {
                            if (Appanel.profile.contains(newName)) {
                                alert('Profile ' + newName + ' already exists!');
                            } else {
                                Appanel.profile.save(newName);
                                Appanel.profile.remove(data.oldName);
                                Appanel.profile.setCurrent(newName);
                                Appanel.util.refresh();
                            }
                        }, {oldName: oldName});
                }]]);

                // handle color buttons
                var colorPanel = $('.theme .colors'),
                    title, button;
                for (var i in theme) {
                    themeProperty = theme[i];
                    if ($.isArray(themeProperty) || themeProperty.constructor === Function || themeProperty.sourceProperty != null) continue;
                    button = colorPanel.find('.color-' + i);
                    title = button[0].innerText;
                    Appanel.map([
                        [button, 'click', function (ev) {
                            Appanel.util.input(ev.data.title, 'Enter color value:', ev.data.property.get(),
                                function (data, color) {
                                    data.property.set(color);
                                    Appanel.profile.save($('.profile-name')[0].innerText);
                                }, {property: ev.data.property});
                        }, {title: title, property: themeProperty}]
                    ]);
                }
            },

            start: function (now) {
                var hour = now.getHours(),
                    minute = now.getMinutes(),
                    second = now.getSeconds(),
                    clock = Appanel.clock,
                    useSweep = clock.useSweep;

                clock.ticker = $('.ticker');
                clock.$second = $('.second');
                clock.$minute = $('.minute');
                clock.$hour = $('.hour');
                clock.sweeper = $('.hour,.minute,.second');

                if (clock.useSweep) {
                    var options = {
                        duration: 0.00001,
                        on: "sweep:ready",
                        sweep: []
                    };

                    //1round = 12hours = 60s x 60 x 12 (loop=1day=2rounds)
                    options.sweep.push(this.getSweeper('.hour > svg', 'ani-clock', 43200, 2));

                    //1round = 60minutes = 60s x 60 (loop=1day=12rounds)
                    options.sweep.push(this.getSweeper('.minute > svg', 'ani-clock', 3600, 12));

                    //1round = 1minutes = 60s (loop=1day=43200rounds)
                    options.sweep.push(this.getSweeper('.second > svg', 'ani-clock', 60, 3600));

                    clock.sweep = options;
                }

                // force move clock hands
                Appanel.clock.useSweep = false;
                clock.setSecond(second + 1);
                clock.setMinute(minute);
                clock.setHour(hour);
                Appanel.clock.useSweep = useSweep;

                this.timeout = setTimeout(function () {
                    if (Appanel.clock.useSweep) {
                        Appanel.clock.sweeper.sweep(Appanel.clock.sweep);
                    } else {
                        Appanel.clock.sweeper.addClass('css-trans');
                    }

                    setInterval(function () {
                        Appanel.clock.secondTick();
                        Appanel.clock.refreshTime();
                    }, 1000);

                    clearTimeout(Appanel.clock.timeout);
                }, 1000 - now.getMilliseconds());
            },

            getSweeper: function (selector, play, duration, loop) {
                return {
                    selector: selector,
                    play: play,
                    timing: 'linear',
                    duration: duration,
                    loop: loop
                };
            },

        },

        util: {
            input: function (title, label, defaultValue, handler, data) {
                if (data === undefined) data = {};

                var inputPanel = $('.input-panel');
                inputPanel.find('label')[0].innerText = label;
                inputPanel.find('input')[0].defaultValue = defaultValue;

                // show dialog with max-number-input
                var dialogue = Appanel.selection('information', title, inputPanel[0].innerHTML, {
                    buttons: ['OK', 'Cancel']
                });

                Appanel.map([
                    [dialogue, 'selection:open', function (ev, button) {
                        var $input = $(ev.target).find('input');
                        $input[0].select();
                        $input.focus();
                    }],
                    [dialogue, 'selection:closed', function (ev, button) {
                        if (button.button === 'OK') {
                            var number = $(ev.target).find('input')[0].value;
                            handler(ev.data, isNaN(number) ? number : Math.abs(number));
                        }
                    }, data]
                ]);
            },

            refresh: function () {
                var src = window.top.location.href,
                    lastIndex = src.indexOf("?");
                src = src.substr(0, lastIndex > 0 ? lastIndex : src.length) + '?refresh=' + Date().toString();
                window.top.location.href = src;
            }
        },

        ready: function () {
            this.createMinutes($('.five.minutes'), {
                "0": 0,
                "1": 30,
                "2": 60,
                "3": 0,//90,
                "4": 120,
                "5": 150,
                "6": 0,//180,
                "7": 210,
                "8": 240,
                "9": 0,//270,
                "10": 300,
                "11": 330,
                "12": 0//360
            }, 12);

            this.createMinutes($('.one.minutes'), {
                "0": 0,
                "1": 6,
                "2": 12,
                "3": 18,
                "4": 24,
                "5": 0,//30,
                "6": 36,
                "7": 42,
                "8": 48,
                "9": 54,
                "10": 0,//60,
                "11": 66,
                "12": 72,
                "13": 78,
                "14": 84,
                "15": 0,//90,
                "16": 96,
                "17": 102,
                "18": 108,
                "19": 114,
                "20": 0,//120,
                "21": 125.99999999999999,
                "22": 132,
                "23": 138,
                "24": 144,
                "25": 0,//150,
                "26": 156,
                "27": 162,
                "28": 168,
                "29": 174,
                "30": 0,//180,
                "31": 186.00000000000003,
                "32": 192,
                "33": 198.00000000000003,
                "34": 204,
                "35": 0,//210,
                "36": 216,
                "37": 222,
                "38": 228,
                "39": 234,
                "40": 0,//240,
                "41": 246,
                "42": 251.99999999999997,
                "43": 258,
                "44": 264,
                "45": 0,//270,
                "46": 276,
                "47": 282,
                "48": 288,
                "49": 294,
                "50": 0,//300,
                "51": 306,
                "52": 312,
                "53": 318,
                "54": 324,
                "55": 0,//330,
                "56": 336,
                "57": 342,
                "58": 348,
                "59": 354
            }, 60);

            Appanel.clock.start(new Date());

            // need to show after started
            $('.clock').css('display', 'block');

            this.refreshAfter(3600);
            this.clock.initProfile();
        },

        createMinutes: function (container, degrees, count) {
            var template = container[0].innerHTML;
            container[0].innerHTML = "";
            for (var i = 0; i < count; i++) {
                if (degrees[i] === 0) continue;
                container.append(template.replace('number-id', 'number-' + i));
                container.find('.number-' + i).css('transform', 'rotate(' + degrees[i] + 'deg)');
            }
        },

        refreshAfter: function (seconds) {
            var timeout = setTimeout(function () {
                clearTimeout(timeout);
                Appanel.util.refresh();
            }, seconds * 1000);
        }
    });
</script>
</body>
</html>
