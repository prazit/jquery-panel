<!DOCTYPE html>
<html>

<head>
    <title>Analog Clock using focus-3.html</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="focus-3.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="http://localhost/scbs/css/sym-fa.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="http://localhost/scbs/css/ani-anicss.css"/>
    <style>
        @keyframes ani-clock {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .ani-clock {
            -webkit-animation-name: ani-clock;
            animation-name: ani-clock;
        }

        @keyframes ani-hide-circle-progress {
            0% {
                stroke-dashoffset: 0;
            }
            100% {
                stroke-dashoffset: -31.415926535897932384626433832795;
            }
        }

        .ani-hide-circle-progress {
            -webkit-animation-name: ani-hide-circle-progress;
            animation-name: ani-hide-circle-progress;
            animation-timing-function: linear;
        }

        .cover {
            position: absolute;
            width: 100vh;
            height: 100vh;
            left: calc((100vw - 100vh) / 2);
        }

        .clock {
            position: absolute;
            width: 100vh;
            height: 100vh;
            display: none;
        }

        .css-trans {
            transition-duration: 0.2s;
        }
    </style>
</head>

<body class="css-trans fixed background--c0 fit-width fit-height" style="font-family: Arial,sans-serif;">

<div class="out-side fixed fit-width fit-height">
    <h1 class="on-top footprint padding--x10 opacity--x0 opacity--x100--at">Analogue Clock v1</h1>
</div>

<div class="cover">
    <!-- this content will be replaced by clock -->
</div>

<!-- ticker -->
<div class="on-top-right padding--x5 hidden">
    <span class="text--c3 text--x2 ticker"></span>
</div>

<!-- animation selector -->
<div class="on-top-left css-trans opacity--x0 opacity--x100--at margin--x20" style="display: inline-block">
    <div class="rounded--x50 center-text">
        <span class="analogue-move button left-child fcBackground border--x4 background--c1 background--c0--at border--x3 border--c3 padding--x10 symbol text--c3" title="count up to max">Analogue Move</span>
        <span class="smooth-move button right-child fcBackground border--x4 background--c1 background--c0--at border--x3 border--c3 padding--x10 symbol text--c3" title="count up to last-max and increase last-max every loop">Smooth Move</span>
    </div>
</div>

<!-- clocks -->
<div class="clocks css-trans on-bottom-left margin--x10 opacity--x0 opacity--x100--at rounded--x20 border--x4 border--c3">
    <span class="clock-list top-child background--c1 padding--x10 center-text">Clocks</span>
    <div class="clock-container">
        <span class="clock-item button child background--c1 background--c0--at padding--x10 left-text">clock-name</span>
    </div>
    <span class="bottom-child background--c1 padding--x10 center-text"></span>
</div>

<!-- colors -->
<div class="css-trans on-right theme margin--x10 opacity--x0 opacity--x100--at columns">
    <div class="column-1-2">
        <div class="rounded--x20 border--x4 border--c3">
            <span class="profile-list button top-child background--c1 background--c0--at padding--x10 center-text">Profiles</span>
            <div class="profile-container">
                <span class="profile button child background--c1 background--c0--at padding--x10 left-text">profile-name</span>
            </div>
            <span class="add-profile button bottom-child background--c1 background--c0--at padding--x10 center-text">+</span>
        </div>
    </div>
    <div class="column-1-2">
        <div class="rounded--x20 border--x4 border--c3 colors">
            <span class="profile-name button top-child background--c1 background--c0--at padding--x10 center-text">Profile</span>
            <span class="color-handSecond button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Second Hand</span>
            <span class="color-handMinute button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Minute Hand</span>
            <span class="color-handHour button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Hour Hand</span>
            <span class="color-numbers button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Numbers</span>
            <span class="color-minutes button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Minutes</span>
            <span class="color-fiveMinutes button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Five Minutes</span>
            <span class="color-frame button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Frame</span>
            <span class="color-background button child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Background</span>
            <span class="color-outSide button bottom-child background--c1 background--c0--at padding--x10 left-text symbol sym-dot-circle-o symbol--c3"> Outside</span>
        </div>
    </div>
</div>

<!-- input -->
<div class="input-panel opacity--x0" style="overflow:hidden;max-width:0px;">
    <label>Please enter value:</label>
    <input type="text" value="10" class="text--c0 width--fit"/>
</div>

<!-- message -->
<div class="message-container on-top-left css-trans"></div>
<div class="warning-message hidden css-trans rounded--x10 margin--x10 padding--x10 background--c3 text--cred background--cyellow">
    <h1 class="symbol sym-warning"> message-title</h1>
    <p class="text--c0">message-text</p>
</div>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
     viewBox="0 0 12 12"
     class="circle-progress float-right hidden"
     style="width:20px;transform:rotate(-90deg);"
     fill="transparent"
     stroke="gray">
    <circle cx="6" cy="6" r="5"
            stroke-linecap="round"
            stroke-opacity="1"
            stroke-width="2"
            stroke-dashoffset="0"
            stroke-dasharray="31.415926535897932384626433832795"/>
</svg>

<!-- JS -->
<script type="text/javascript" src="http://localhost/jquery/1.11/jquery.js"></script>
<script type="text/javascript" src="../dist/jquery.panel.suite.min.js"></script>
<script type="text/javascript" src="../src/jquery.theme.js?version=1"></script>
<script>
    Appanel({
        clock: {
            useSweep: false,
            speed: 1,

            name: 'analogue-clock',
            state: 'initialized',

            setUseSweep: function (useSweep) {
                var changed = this.useSweep != useSweep;
                this.useSweep = useSweep;
                Appanel.profile.more.useSweep = useSweep;
                Appanel.profile.save();

                if (changed) {
                    if (!useSweep)
                        Appanel.util.refresh();
                    else
                        this.start(new Date(), this.speed);
                }
            },

            setSecond: function (second) {
                this.percentSecond = second / 60;
                if (!this.useSweep) {
                    if (this.state === 'starting' && second >= 59) {
                        /*console.debug('setSecond: in case starting at 59');*/
                        this.$second.css('transform', 'rotate(-6deg)');
                    } else if (second === 59) {
                        /*console.debug('setSecond: in case of 59');*/
                        this.$second.css('transform', 'rotate(' + (this.percentSecond * 360) + 'deg)');
                        this.setTimeout(function () {
                            Appanel.clock.$second.removeClass('css-trans');
                            Appanel.clock.$second.css('transform', 'rotate(-6deg)');
                            Appanel.clock.setTimeout(function () {
                                Appanel.clock.$second.addClass('css-trans');
                            }, 100);
                        }, 100);
                    } else {
                        /*console.debug('setSecond: in another case');*/
                        this.$second.css('transform', 'rotate(' + (this.percentSecond * 360) + 'deg)');
                    }
                }
                this.second = second;
            },

            setMinute: function (minute) {
                if (this.useSweep) {
                    this.percentMinute = (minute + this.percentSecond) / 60;
                } else {
                    this.percentMinute = minute / 60;
                    this.minuteDegree = (this.percentMinute * 360);
                    if (this.state === 'starting' && minute >= 59) {
                        /*console.debug('setMinute: in case starting at 59');*/
                        Appanel.clock.$minute.css('transform', 'rotate(-' + (360 - Appanel.clock.minuteDegree) + 'deg)');
                    } else if (minute === 59) {
                        /*console.debug('setMinute: in case of 59');*/
                        this.$minute.css('transform', 'rotate(' + this.minuteDegree + 'deg)');
                        this.setTimeout(function () {
                            Appanel.clock.$minute.removeClass('css-trans');
                            Appanel.clock.$minute.css('transform', 'rotate(-' + (360 - Appanel.clock.minuteDegree) + 'deg)');
                            Appanel.clock.setTimeout(function () {
                                Appanel.clock.$minute.addClass('css-trans');
                            }, 100);
                        }, 100);
                    } else {
                        /*console.debug('setMinute: in another case');*/
                        this.$minute.css('transform', 'rotate(' + this.minuteDegree + 'deg)');
                    }

                    // update hour hand at every minute
                    if (this.hour !== undefined) this.setHour(this.hour);
                }
                this.minute = minute;
            },

            setHour: function (hour) {
                if (!this.useSweep) {
                    this.hourDegree = ((hour + this.percentMinute) / 12) * 360;
                    if (hour === 11) {
                        if (this.hour !== hour) {
                            /*console.debug('setHour: in case of 11');*/
                            this.$hour.css('transform', 'rotate(' + this.hourDegree + 'deg)');
                            this.setTimeout(function () {
                                Appanel.clock.$hour.removeClass('css-trans');
                                Appanel.clock.$hour.css('transform', 'rotate(-' + (360 - Appanel.clock.hourDegree) + 'deg)');
                                Appanel.clock.setTimeout(function () {
                                    Appanel.clock.$hour.addClass('css-trans');
                                }, 100);
                            }, 100);
                        } else {
                            /*console.debug('setHour: in case after 11');*/
                            Appanel.clock.$hour.css('transform', 'rotate(-' + (360 - Appanel.clock.hourDegree) + 'deg)');
                        }
                    } else {
                        /*console.debug('setHour: in another case');*/
                        this.$hour.css('transform', 'rotate(' + this.hourDegree + 'deg)');
                    }
                }
                this.hour = hour;
            },

            refreshTime: function () {
                this.ticker[0].innerText = this.hour + ':' + this.minute + ':' + this.second;
            },

            secondTick: function () {
                var second = this.second + 1;
                if (second >= 60)
                    this.minuteTick();
                else
                    this.setSecond(second);
            },

            minuteTick: function () {
                this.setSecond(0);

                var minute = this.minute + 1;
                if (minute === 60)
                    this.hourTick();
                else
                    this.setMinute(minute);
            },

            hourTick: function () {
                this.setMinute(0);

                var hour = this.hour + 1;
                if (hour === 24)
                    this.setHour(0);
                else
                    this.setHour(hour);
            },

            addProperty: function (theme, name, prop, target) {
                $(theme.add(name, prop, target)).on('css-property:error', function (ev, data) {
                    var $container = $('.message-container'),
                        $message;
                    $container.append(
                        $('.warning-message')[0].outerHTML
                            .replace('message-title', 'Invalid Color')
                            .replace('message-text', `css-property '${data.property}' not supports the value '${data.value}'`)
                    );
                    $message = $container.find('.warning-message')
                        .removeClass('warning-message')
                        .removeClass('hidden');

                    Appanel.util.removeAfter(6, $message);
                });
            },

            initProfile: function () {
                var theme = new Theme();
                this.addProperty(theme, 'handSecond', ['stroke', 'fill'], $('.second svg'));
                this.addProperty(theme, 'handMinute', ['stroke', 'fill'], $('.minute svg'));
                this.addProperty(theme, 'handHour', ['stroke', 'fill'], $('.hour svg'));
                this.addProperty(theme, 'numbers', ['stroke', 'fill'], $('.numbers text'));
                this.addProperty(theme, 'minutes', ['stroke', 'fill'], $('.one.minutes line'));
                this.addProperty(theme, 'fiveMinutes', ['stroke', 'fill'], $('.five.minutes line'));
                this.addProperty(theme, 'frame', 'stroke', $('.numbers circle'));
                this.addProperty(theme, 'background', 'fill', $('.numbers circle'));
                this.addProperty(theme, 'outSide', 'background-color', $('.out-side'));

                theme.add('chandSecond', 'background-color', $('.color-handSecond'), 'handSecond');
                theme.add('chandMinute', 'background-color', $('.color-handMinute'), 'handMinute');
                theme.add('chandHour', 'background-color', $('.color-handHour'), 'handHour');
                theme.add('cnumbers', 'background-color', $('.color-numbers'), 'numbers');
                theme.add('cminutes', 'background-color', $('.color-minutes'), 'minutes');
                theme.add('cfiveMinutes', 'background-color', $('.color-fiveMinutes'), 'fiveMinutes');
                theme.add('cframe', 'background-color', $('.color-frame'), 'frame');
                theme.add('cbackground', 'background-color', $('.color-background'), 'background');
                theme.add('coutSide', 'background-color', $('.color-outSide'), 'outSide');

                this.handle(new Profile(this.name, theme, {useSweep: false}));
            },

            handle: function (profile) {
                Appanel['profile'] = profile;

                if (!profile.contains('default')) {
                    profile.save('default', {
                        theme: {
                            handSecond: 'red',
                            handMinute: 'orange',
                            handHour: 'gold',
                            numbers: 'gold',
                            minutes: '#000000',
                            fiveMinutes: '#222222',
                            frame: 'silver',
                            background: 'navy',
                            outSide: 'bluesky'
                        },
                        more: {useSweep: this.useSweep, clock: 'original'}
                    });
                }

                var e = $('.theme .profile'),
                    container = e.parents('.profile-container'),
                    template = container[0].innerHTML,
                    clockContainer = $('.clock-container'),
                    clockTemplate = clockContainer[0].innerHTML,
                    count = profile.ids.length,
                    theme = profile.theme,
                    themeProperty;

                // handle movement buttons
                Appanel.map([
                    ['.analogue-move', 'click', function () {
                        Appanel.clock.setUseSweep(false);
                    }],
                    ['.smooth-move', 'click', function () {
                        Appanel.clock.setUseSweep(true);
                    }]
                ]);

                // handle clock buttons
                clockContainer[0].innerHTML = "";
                for (var i = 0; i < this.clocks.length; i++) {
                    clockContainer.append(clockTemplate.replace('clock-name', this.clocks[i].display));
                    button = clockContainer.find('.clock-item').removeClass('clock-item');
                    Appanel.map([
                        [button, 'click', function (ev) {
                            Appanel.clock.loadClock(ev.data.index);
                            /*Appanel.clock.updateElements();
                            Appanel.profile.theme.updateElements();
                            Appanel.profile.load(Appanel.profile.current);*/
                            Appanel.util.refresh();
                        }, {name: this.clocks[i].name, index: i}]
                    ]);
                    if (this.clocks[i].name === profile.more.clock) button.click();
                }

                // handle profile buttons
                container[0].innerHTML = "";
                for (var i = 0; i < count; i++) {
                    container.append(template.replace('profile-name', profile.ids[i]));
                    button = container.find('.profile').removeClass('profile');
                    Appanel.map([
                        [button, 'click', function (ev) {
                            var profile = Appanel.profile.load(ev.data.profile);
                            Appanel.clock.setUseSweep(profile.more.useSweep);
                            $('.profile-name')[0].innerText = ev.data.profile;
                        }, {theme: profile.theme, profile: profile.ids[i]}]
                    ]);
                    if (profile.ids[i] === profile.current) button.click();
                }

                // handle add profile button
                Appanel.map([[$('.theme .add-profile'), 'click', function (ev) {
                    Appanel.util.input('New Profile', 'Enter profile name:', 'default',
                        function (data, name) {
                            if (Appanel.profile.contains(name)) {
                                alert('Profile ' + name + ' already exists!');
                            } else {
                                Appanel.profile.save(name);
                                Appanel.util.refresh();
                            }
                        });
                }]]);

                // handle profile name button
                button = $('.theme .profile-name');
                Appanel.map([[button, 'click', function (ev) {
                    var oldName = ev.currentTarget.innerText;
                    Appanel.util.input('Change Profile Name', 'Enter new name:', oldName,
                        function (data, newName) {
                            if (Appanel.profile.contains(newName)) {
                                alert('Profile ' + newName + ' already exists!');
                            } else {
                                Appanel.profile.save(newName);
                                Appanel.profile.remove(data.oldName);
                                Appanel.profile.setCurrent(newName);
                                Appanel.util.refresh();
                            }
                        }, {oldName: oldName});
                }]]);

                // handle color buttons
                var colorPanel = $('.theme .colors'),
                    title, button;
                for (var i in theme) {
                    themeProperty = theme[i];
                    if (i.startsWith('jQuery') || $.isArray(themeProperty) || themeProperty.constructor === Function || themeProperty.sourceProperty != null) continue;
                    button = colorPanel.find('.color-' + i);
                    title = button[0].innerText;
                    Appanel.map([
                        [button, 'click', function (ev) {
                            Appanel.util.input(ev.data.title, 'Enter color value:', ev.data.property.get(),
                                function (data, color) {
                                    data.property.set(color);
                                    Appanel.profile.save($('.profile-name')[0].innerText);
                                }, {property: ev.data.property});
                        }, {title: title, property: themeProperty}]
                    ]);
                }
            },

            setTimeout: function (func, millisec) {
                this.clearTimeout();
                this.timeout = window.setTimeout(func, millisec);
            },

            clearTimeout: function () {
                if (this.timeout !== undefined) {
                    clearTimeout(this.timeout);
                    delete this.timeout;
                }
            },

            setInterval: function (func, millisec) {
                this.clearInterval();
                this.interval = window.setInterval(func, millisec);
            },

            clearInterval: function () {
                if (this.interval !== undefined) {
                    clearInterval(this.interval);
                    delete this.interval;
                }
            },

            updateElements: function () {
                this.$second = $(this.$second.selector);
                this.$minute = $(this.$minute.selector);
                this.$hour = $(this.$hour.selector);
                this.sweeper = $(this.sweeper.selector);
            },

            start: function (now, speed) {
                var hour = now.getHours(),
                    minute = now.getMinutes(),
                    second = now.getSeconds(),
                    clock = Appanel.clock,
                    useSweep = clock.useSweep;

                clock.state = 'starting';

                if (speed === undefined) speed = 1;
                clock.speed = speed;
                console.info("clock start at ", hour, ":", minute, ":", second, ' ', speed, 'X speed');

                clock.ticker = $('.ticker');
                clock.$second = $('.second');
                clock.$minute = $('.minute');
                clock.$hour = $('.hour');
                clock.sweeper = $('.hour,.minute,.second').addClass('hidden');

                if (clock.useSweep) {
                    var options = {
                        duration: 0.00001,
                        on: "sweep:ready",
                        sweep: []
                    };

                    //1round = 12hours = 60s x 60 x 12 (loop=1day=2rounds)
                    options.sweep.push(this.getSweeper('.hour > svg', 'ani-clock', 43200, 2));

                    //1round = 60minutes = 60s x 60 (loop=1day=12rounds)
                    options.sweep.push(this.getSweeper('.minute > svg', 'ani-clock', 3600, 12));

                    //1round = 1minutes = 60s (loop=1day=43200rounds)
                    options.sweep.push(this.getSweeper('.second > svg', 'ani-clock', 60, 3600));

                    clock.sweep = options;
                }

                // force move clock hands
                Appanel.clock.useSweep = false;
                clock.setSecond(second + 1);
                clock.setMinute(minute);
                clock.setHour(hour);
                Appanel.clock.useSweep = useSweep;

                // reset all animations
                if (clock.sweeper[0].sweepID) {
                    clock.sweeper
                        .sweep('pause')
                        .each(function (i, e) {
                            delete e.sweepID;
                            delete e.sweepContext;
                        })
                        .find('svg')
                        .each(function (i, e) {
                            delete e.sweepID;
                            delete e.sweepContext;
                        })
                        .removeClass('ani-clock')
                        .css('transform', 'rotate(0deg)')
                        .css('animation-duration', '')
                        .css('animation-iteration-count', '')
                        .css('animation-timing-function', '')
                    ;
                }

                // delay start
                Appanel.clock.setTimeout(function () {
                    var clock = Appanel.clock;

                    if (clock.useSweep) {
                        clock.sweeper.sweep(clock.sweep).sweep('speedx', clock.speed);
                    } else {
                        clock.sweeper.addClass('css-trans');
                    }

                    clock.setInterval(function () {
                        Appanel.clock.sweeper.removeClass('hidden');
                        Appanel.clock.secondTick();
                        Appanel.clock.refreshTime();
                    }, 1000 * (1 / clock.speed));

                }, 1000 - now.getMilliseconds());

                clock.state = 'started';
            },

            getSweeper: function (selector, play, duration, loop) {
                return {
                    selector: selector,
                    play: play,
                    timing: 'linear',
                    duration: duration,
                    loop: loop
                };
            },

            clocks: [],

            clockIndex: function (name) {
                var clocks = this.clocks;
                for (var i = 0; i < clocks.length; i++) {
                    if (clocks[i].name === name) return i;
                }
                return 0;
            },

            loadClocks: function () {
                var requestDate = (new Date()).toLocaleTimeString(),
                    myJson = Appanel.util.myURL() + '.json?v=' + requestDate;

                // test: get list of clock from json file
                console.info("Clocks URL: ", myJson);
                $.getJSON(myJson).complete(function (json, status) {
                    console.info('respond at ', new Date().toLocaleTimeString());
                    Appanel.clock.clocks = json.responseJSON;
                    Appanel.clock.loadClock(Appanel.clock.clockIndex(Appanel.get(Appanel.clock.name + ':clock')));
                });
            },

            loadClock: function (clockIndex) {
                var clock = this.clocks[clockIndex],
                    requestDate = (new Date()).toLocaleTimeString(),
                    clockName = clock.name,
                    url = Appanel.util.myURL() + '-' + clockName + '.html?v=' + requestDate;

                this.clock = clockName;
                Appanel.set(this.name + ':clock', clockName);

                // test: get clock from first element
                console.info("Clock URL: ", url);
                $.get(url).complete(function (result, status) {
                    var clockHtml = result.responseText,
                        headStart = clockHtml.indexOf('<head>'),
                        headEnd = clockHtml.indexOf('</head>') + 7;
                    console.info('respond at ', new Date().toLocaleTimeString());
                    clockHtml = clockHtml.substring(0, headStart) + clockHtml.substring(headEnd + 1);
                    $('.cover').html(clockHtml);
                    Appanel.clock.setTimeout(function () {
                        Appanel.clock.ready();
                    }, 100);
                });
            },

            /**
             * Example:
             * Appanel.clock.setAttributes({
             *      image: 'img/swiss-railway-clock-scaled.webp',
             *      imageW: 2560,
             *      imageH: 1707,
             *      imageFilter: 0.25,
             *
             *      coverYInPercent: 0.311,
             *      coverWInPercent: 0.25,
             *
             *      coverXInPercent: 0.5715,
             *      coverHInPercent: 0.37
             * });
             */
            setAttributes: function (attributes) {
                this.bgImageAttributes = Object.assign(attributes, {
                    body: $('body')
                        .removeClass('css-trans')
                        .css('background-image', 'url(' + attributes.image + ')')
                        .css('background-repeat', 'no-repeat'),
                    cover: $('.cover'),
                    clock: $('.clock')
                });

                $('.out-side').css('opacity', (100 * this.bgImageAttributes.imageFilter) + '%');

                var resize = function (ev) {
                    var a = Appanel.clock.bgImageAttributes;

                    a.screenW = parseInt(a.body.css('width'));
                    a.screenH = parseInt(a.body.css('height'));

                    a.ratioW = a.screenW / a.imageW;
                    a.ratioH = a.screenH / a.imageH;

                    if (a.ratioW >= a.ratioH) {
                        a.imageX = 0;
                        a.imageY = (a.screenH - (a.ratioW * a.imageH)) / 2;
                        a.coverX = a.coverXInPercent * a.screenW;
                        a.coverY = a.imageY + (a.ratioW * a.imageH * a.coverYInPercent);
                        a.imageSize = a.screenW;
                        a.coverSize = '25vw';
                    } else {
                        a.imageX = (a.screenW - (a.ratioH * a.imageW)) / 2;
                        a.imageY = 0;
                        a.coverX = a.imageX + (a.ratioH * a.imageW * a.coverXInPercent);
                        a.coverY = a.coverYInPercent * a.screenH;
                        a.imageSize = a.imageW * a.ratioH;
                        a.coverSize = '37vh';
                    }

                    a.body
                        .css('background-position-x', a.imageX + 'px')
                        .css('background-position-y', a.imageY + 'px')
                        .css('background-size', a.imageSize + 'px');

                    a.cover
                        .css('top', a.coverY + 'px')
                        .css('left', a.coverX + 'px');

                    a.clock
                        .css('width', a.coverSize)
                        .css('height', a.coverSize);

                    console.debug('resize: Attributes=', a);
                };

                $(window).on('resize', resize);
                resize();
            },

            ready: function () {
                this.start(new Date());
                /*this.start(new Date(2022, 12, 24, 10, 59, 59), 3);*/

                // need to show after started
                $('.clock').css('display', 'block');

                this.initProfile();
            }

        },

        util: {
            input: function (title, label, defaultValue, handler, data) {
                if (data === undefined) data = {};

                var inputPanel = $('.input-panel');
                inputPanel.find('label')[0].innerText = label;
                inputPanel.find('input')[0].defaultValue = defaultValue;

                // show dialog with max-number-input
                var dialogue = Appanel.selection('information', title, inputPanel[0].innerHTML, {
                    buttons: ['OK', 'Cancel']
                });

                Appanel.map([
                    [dialogue, 'selection:open', function (ev, button) {
                        var $input = $(ev.target).find('input');
                        $input[0].select();
                        $input.focus();
                    }],
                    [dialogue, 'selection:closed', function (ev, button) {
                        if (button.button === 'OK') {
                            var number = $(ev.target).find('input')[0].value;
                            handler(ev.data, isNaN(number) ? number : Math.abs(number));
                        }
                    }, data]
                ]);
            },

            refresh: function () {
                var src = window.top.location.href,
                    lastIndex = src.indexOf("?");
                src = src.substr(0, lastIndex > 0 ? lastIndex : src.length) + '?refresh=' + (new Date()).toLocaleTimeString();
                window.top.location.href = src;
            },

            refreshAfter: function (seconds) {
                var timeout = setTimeout(function () {
                    clearTimeout(timeout);
                    Appanel.util.refresh();
                }, seconds * 1000);
            },

            removeAfter: function (seconds, $e) {
                $e.append($('.circle-progress')[0].outerHTML.replace('hidden', ''));
                var timeout = setTimeout(function () {
                    clearTimeout(timeout);
                    $e.remove();
                }, seconds * 1000);
                Appanel.chains($e.find('.circle-progress > circle'), 'ani-hide-circle-progress:' + seconds);
            },

            myURL: function () {
                var location = window.location;
                src = location.origin + location.pathname;
                src.indexOf('clock-1.html');
                return src.replace('.html', '');
            },

            createMinutes: function (container, degrees, count) {
                var template = container[0].innerHTML;
                container[0].innerHTML = "";
                for (var i = 0; i < count; i++) {
                    if (degrees[i] === 0) continue;
                    container.append(template.replace('number-id', 'number-' + i));
                    container.find('.number-' + i).css('transform', 'rotate(' + degrees[i] + 'deg)');
                }
            }
        },

        ready: function () {
            Appanel.clock.loadClocks();
            Appanel.util.refreshAfter(3600);
        }
    });
</script>
</body>
</html>
